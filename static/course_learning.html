<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Vocabulary – FluentMind</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', path='css/common.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='css/vocabulary.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='css/settings.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='css/course_learning.css') }}" />
</head>

<body class="vocabulary-page">
  <header>
    <div class="wrap row">
      <div class="brand">
        <img src="{{ url_for('static', path='img/logo-small.png') }}" alt="FluentMind logo" />
        <span>FluentMind</span>
      </div>
      <nav>
        <a href="/">Main</a>
        <a href="#" class="active">Learn now</a>
        <a href="/pricing">Pricing</a>
        <a href="/contacts">Contacts</a>
      </nav>
      <div class="lang">en | ua</div>
    </div>
  </header>

  <main class="wrap settings-wrapper">
    <aside class="settings-sidebar">
      <nav class="settings-nav" aria-label="Profile navigation">
        <button type="button">
          <img src="{{ url_for('static', path='img/settings/nav-learn.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
          <span class="settings-nav__label"><a href='/learn'>Learn</a></span>
        </button>
        <button type="button">
          <img src="{{ url_for('static', path='img/settings/nav-vocabulary.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
          <span class="settings-nav__label"><a href='/vocabulary'>Vocabulary</a></span>
        </button>
        <button type="button"  class="active">
          <img src="{{ url_for('static', path='img/settings/nav-previous-lessons.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
          <span class="settings-nav__label">Course Content</span>
        </button>
        <button type="button">
          <img class="settings-nav__icon" src="{{ url_for('static', path='img/settings/nav-settings.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
          <span class="settings-nav__label"><a href='/settings'>Settings</a></span>
        </button>
      </nav>
    </aside>
    <div class="course-content-wrapper">
      <h1>Course Content</h1>
      <div id="modules-container">
          
      </div>
    </div>
  </main>

  <script>
    const course_id = {{ course.course_id }};
    
    async function generateModule(moduleNumber, buttonElement) {
        if (buttonElement.disabled) return;
        
        buttonElement.disabled = true;
        buttonElement.innerText = "Generating...";
        
        try {
            const response = await fetch(`/api/generate-module?course_id=${course_id}&module_number=${moduleNumber}`);
            const data = await response.json();
            
            if (data.success) {
                alert("Module generated successfully!");
                location.reload(); 
            } else {
                alert("Failed to generate module: " + (data.message || "Unknown error"));
                buttonElement.disabled = false;
                buttonElement.innerText = "Generate Content";
            }
        } catch (error) {
            console.error(error);
            alert("An error occurred.");
            buttonElement.disabled = false;
            buttonElement.innerText = "Generate Content";
        }
    }

    async function getModules() {
        const container = document.getElementById('modules-container');
        container.innerHTML = ''; 

        const response = await fetch(`/api/get-modules?course_id=${course_id}`, {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            }
        });
        const data = await response.json();
        
        if (data.success && data.modules) {
          data.modules.forEach(module => {
              const moduleDiv = document.createElement('div');
              moduleDiv.className = 'module-card';
              
              let contentObj = {};
              try {
                  if (module.content_html) {
                      const parsed = JSON.parse(module.content_html);
                      if (parsed && typeof parsed === 'object') {
                          contentObj = parsed;
                      }
                  }
              } catch (e) {
                  console.error('Failed to parse content_html', e);
              }

              let descriptionHtml = '';
              if (contentObj.topics) {
                  descriptionHtml += `<h3>Topics</h3><ul>${contentObj.topics.map(t => `<li>${t}</li>`).join('')}</ul>`;
              }
              if (contentObj.objectives) {
                  descriptionHtml += `<h3>Objectives</h3><ul>${contentObj.objectives.map(o => `<li>${o}</li>`).join('')}</ul>`;
              }

              // Determine if actions
              let actionHtml = '';
              const isVirtual = String(module.module_id).startsWith('plan_');
              
              if (isVirtual) {
                 actionHtml = `<button class="btn" onclick="generateModule(${module.week_number}, this)">Generate Content</button>`;
              } else {
                 actionHtml = `<a class="btn" href="/learn/course${module.course_id}/module${module.week_number}">Start Module</a>`;
              }

              moduleDiv.innerHTML = `<h2>${module.title}</h2>
                                     <div>${descriptionHtml}</div>
                                     <div class="module-actions">${actionHtml}</div>`;
              container.appendChild(moduleDiv);
          });
        }
    }
    addEventListener('DOMContentLoaded', getModules);
  </script>
  <footer>
    <div class="wrap">
      <div class="foot-top">
        <div class="foot-brand">
          <img src="{{ url_for('static', path='img/logo-large.png') }}" alt="FluentMind logo large" />
        </div>
        <ul class="contact-list">
          <li><img src="{{ url_for('static', path='img/icon-location.png') }}" alt="" /> <span><strong>Address:</strong> X street, city Zaporizhzhia, Ukraine</span></li>
          <li><img src="{{ url_for('static', path='img/icon-mail.png') }}" alt="" /> <span><strong>Email:</strong> vyshnevetskyivolodymyr@gmail.com</span></li>
          <li><img src="{{ url_for('static', path='img/icon-phone.png') }}" alt="" /> <span><strong>Phone:</strong> +38 (063) 7597571</span></li>
        </ul>
        <div>
          <div class="socials-foot">
            <img src="{{ url_for('static', path='img/instagram.png') }}" alt="Instagram" />
            <img src="{{ url_for('static', path='img/linkedin.png') }}" alt="LinkedIn" />
            <img src="{{ url_for('static', path='img/facebook.png') }}" alt="Facebook" />
          </div>
        </div>
      </div>
      <div class="foot-bottom">
        <span>©2025 FluentMind All rights reserved.</span>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of use</a>
        <a href="#">Sitemap</a>
      </div>
    </div>
  </footer>

  <script>
  </script>
</body>
</html>
