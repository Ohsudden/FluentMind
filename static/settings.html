<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>FluentMind – Settings</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="{{ url_for('static', path='css/common.css') }}" />
	<link rel="stylesheet" href="{{ url_for('static', path='css/settings.css') }}" />
</head>
<body class="settings-page">
	<header>
		<div class="wrap row">
			<div class="brand">
				<img src="{{ url_for('static', path='img/logo-small.png') }}" alt="FluentMind logo" />
				<span>FluentMind</span>
			</div>
			<nav>
				<a href="/">Main</a>
				<a href="/registration">Learn now</a>
				<a href="/pricing">Pricing</a>
				<a href="/contacts">Contacts</a>
			</nav>
			<div class="lang">en | ua</div>
		</div>
	</header>

	<main class="wrap settings-wrapper">
		<aside class="settings-sidebar">
			<nav class="settings-nav" aria-label="Profile navigation">
				<button type="button">
					<img src="{{ url_for('static', path='img/settings/nav-learn.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
					<span class="settings-nav__label"><a href='/learn'>Learn</a></span>
				</button>
				<button type="button">
					<img src="{{ url_for('static', path='img/settings/nav-vocabulary.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
					<span class="settings-nav__label"><a href=''>Vocabulary</a></span>
				</button>
				<button type="button">
					<img src="{{ url_for('static', path='img/settings/nav-memorize.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
					<span class="settings-nav__label"><a href=''>Memorize</a></span>
				</button>
				<button type="button">
					<img src="{{ url_for('static', path='img/settings/nav-previous-lessons.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
					<span class="settings-nav__label"><a href=''>Previous lessons</a></span>
				</button>
				<button type="button" class="active">
					<img class="settings-nav__icon" src="{{ url_for('static', path='img/settings/nav-settings.svg') }}" width="22" height="22" alt="" aria-hidden="true" />
					<span class="settings-nav__label">Settings</span>
				</button>
			</nav>
		</aside>

		<section class="settings-card">
			<div class="settings-avatar" aria-hidden="true">
				<img src="{{ url_for('static', path='img/settings/avatar-outline.svg') }}" alt="" width="100" height="100" />
			</div>

			<div class="settings-form">
				<h1>Settings</h1>
				<form>
					<div class="row">
						<label for="settings-name">Name</label>
						<input id="settings-name" type="text" name="name" value="{{ user.name if user else '' }}" placeholder="Your Name" disabled/>
					</div>
					<div class="row">
						<label for="settings-surname">Surname</label>
						<input id="settings-surname" type="text" name="surname" value="{{ user.surname if user else '' }}" placeholder="Your Surname" disabled/>
					</div>
					<div class="row">
						<label for="settings-email">Email</label>
						<div class="row-inline">
							<input id="settings-email" type="email" name="email" value="{{ user.email if user else '' }}" placeholder="Your Email" disabled/>
							<button type="button" class="change-btn">Change</button>
						</div>
					</div>
					<div class="row">
						<label for="settings-password">Password</label>
                        <div class="row-inline">
                            <input id="settings-password" type="password" name="password" placeholder="Password" disabled/>
                            <button type="button" class="change-btn" onclick="changePassword(event)">Change</button>
                        </div>
						
					</div>
					<div class="row">
						<label for="settings-native">Native language</label>
						<select id="settings-native" name="native-language">
							<option value="">Select native language</option>
							<option>English</option>
							<option>Ukrainian</option>
						</select>
					</div>
					<div class="row">
						<label for="settings-interface">Interface language</label>
						<select id="settings-interface" name="interface-language">
							<option value="">Select interface language</option>
							<option>English</option>
							<option>Ukrainian</option>
						</select>
					</div>
				</form>
			</div>
		</section>
	</main>

	<footer>
		<div class="wrap">
			<div class="foot-top">
				<div class="foot-brand">
					<img src="{{ url_for('static', path='img/logo-large.png') }}" alt="FluentMind logo large" />
				</div>
				<ul class="contact-list">
					<li><img src="{{ url_for('static', path='img/icon-location.png') }}" alt="" /> <span><strong>Address:</strong> X street, city Zaporizhzhia, Ukraine</span></li>
					<li><img src="{{ url_for('static', path='img/icon-mail.png') }}" alt="" /> <span><strong>Email:</strong> vyshnevetskyivolodymyr@gmail.com</span></li>
					<li><img src="{{ url_for('static', path='img/icon-phone.png') }}" alt="" /> <span><strong>Phone:</strong> +38 (063) 7597571</span></li>
				</ul>
				<div>
					<div class="socials-foot">
						<img src="{{ url_for('static', path='img/instagram.png') }}" alt="Instagram" />
						<img src="{{ url_for('static', path='img/linkedin.png') }}" alt="LinkedIn" />
						<img src="{{ url_for('static', path='img/facebook.png') }}" alt="Facebook" />
					</div>
				</div>
			</div>
			<div class="foot-bottom">
				<span>©2025 FluentMind All rights reserved.</span>
				<a href="#">Privacy Policy</a>
				<a href="#">Terms of use</a>
				<a href="#">Sitemap</a>
			</div>
		</div>
	</footer>

    <script>
    async function saveSettings(event) {
      const form = document.getElementById('settingsForm');
      const formData = new FormData(form);

      try {
        const response = await fetch('/api/settings', {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          alert('Settings saved successfully.');
        } else {
          alert('Failed to save settings. Please try again.');
        }
      } catch (error) {
        console.error('Error saving settings:', error);
        alert('An error occurred. Please try again later.');
      }
    }
    async function changeEmail(event) {
      const emailInput = document.getElementById('settings-email');
      emailInput.disabled = false;
    }

	async function changePassword(event) {
	const button = event.currentTarget;
	const passwordInput = document.getElementById('settings-password');
	let newPasswordInput = document.getElementById('settings-password-new');
	let confirmPasswordInput = document.getElementById('settings-password-new2');

	if (!newPasswordInput || !confirmPasswordInput) {
	const wrapper = document.createElement('div');
	wrapper.className = 'row-inline';
	wrapper.style.display = 'flex';
	wrapper.style.flexDirection = 'column';
		wrapper.innerHTML = `
		<input id="settings-password-new" type="password" name="new_password" placeholder="New Password" />
		<input id="settings-password-new2" type="password" name="confirm_password" placeholder="Confirm New Password" />
		`;

		passwordInput.insertAdjacentElement('afterend', wrapper);
		newPasswordInput = document.getElementById('settings-password-new');
		confirmPasswordInput = document.getElementById('settings-password-new2');
	}

	if (!button.dataset.editing) {
		button.dataset.editing = 'true';
		button.textContent = 'Save';
		passwordInput.disabled = false;
		passwordInput.value = '';
		passwordInput.placeholder = 'Current Password';
		newPasswordInput.disabled = false;
		confirmPasswordInput.disabled = false;
		newPasswordInput.value = '';
		confirmPasswordInput.value = '';
		return;
	}

	const oldPassword = passwordInput.value.trim();
	const newPassword = newPasswordInput.value.trim();
	const confirmPassword = confirmPasswordInput.value.trim();

	if (!oldPassword) {
		alert('Enter your current password.');
		return;
	}

	if (!newPassword || !confirmPassword) {
		alert('Enter a new password in both fields.');
		return;
	}

	if (newPassword !== confirmPassword) {
		alert('New passwords do not match.');
		return;
	}

	const formData = new FormData();
	formData.append('old_password', oldPassword);
	formData.append('new_password', newPassword);

	try {
		const response = await fetch('/api/change-password', {
			method: 'POST',
			body: formData
		});

		const result = await response.json();

		if (!response.ok) {
			alert(result?.message || 'Failed to change password.');
			return;
		}

		alert('Password changed successfully.');
		passwordInput.value = '';
		newPasswordInput.value = '';
		confirmPasswordInput.value = '';
		passwordInput.disabled = true;
		newPasswordInput.disabled = true;
		confirmPasswordInput.disabled = true;
		button.textContent = 'Change';
		delete button.dataset.editing;  
	} catch (error) {
		console.error('Error changing password:', error);
		alert('An error occurred. Please try again later.');
	}
}
  </script>

  </script>
</body>
</html>
